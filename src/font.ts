import { pset } from "./crt";

const mapping = `abcdefghijklmnopqrstuvwxyz .,'!?1234567890-+/()":;%*=[]<>_`;
const src = `[gfx]80205777055557700555577705555770055557770555577705555777055557070555577705555777055557070555570005555777055557770555577705555777055557070555577705555700055557070555577005555770055557000555577705555070055550700555577005555700055557770555570705555707055557070555577705555707055557000555570705555700055557000555570705555707055550700555507005555770055557000555570705555707055557070555577005555707055557770555577705555770055557770555570005555777055557070555577705555770055557070555577705555707055557070555577705555700055550000555500005555000055550000555500005555000055550000555500005555000055550000555500005555000055550000555500005555000055550000555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555577705555777055557770555577705555707055557070555570705555707055557070555577705555000055550000555500005555770055550700555577705555707055557070555570005555070055557070555570705555707055550700555570705555077055550000555500005555000055550700555507005555707055557770555577005555077055550700555570705555707055557770555507005555070055557000555500005555000055550700555500005555000055550000555500705555707055557770555507005555777055550700555577705555707055550700555577705555000055550700555577005555000055550700555500705555000055550000555500005555000055550000555500005555000055550000555500005555000055550000555500005555000055550000555500005555000055555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555557700555577005555777055557070555577705555777055557770555577705555777055550700555500005555070055550070555500705555070055557070555507005555007055550770555570705555770055557000555500705555707055557070555570705555777055557770555507005555070055550070555570705555070055550700555500705555777055550070555577705555007055557770555507705555707055550000555507005555070055550700555500705555000055557770555577705555777055550070555577005555777055550070555577705555770055550700555500005555000055557000555500705555070055550000555500005555000055550000555500005555000055550000555500005555000055550000555500005555000055550000555500005555000055550000555500005555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555070055550700555507005555707055557700555577005555770055550700555570005555000055500000000000000000000000000000000000000000000000050000555500005555000055550700555500005555700055550700555570005555070055550000555000000000000000000000000000000000000000000000000507005555070055557770555570705555770055557000555507005555070055557000555500005550000000000000000000000000000000000000000000000005000055557000555507005555000055550000555577005555770055550000555500005555777055500000000000000000000000000000000000000000000000050000555500005555000055550000555500005555000055550000555500005555000055550000555000000000000000000000000000000000000000000000000555555555555555555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000000000000000000000005555555555555555555555555555555555555555555555555555555555555555555555555555555500000000000000000000000000000000000000000000000055555555555555555555555555555555555555555555555555555555555555555555555555555555000000000000000000000000000000000000000000000000[/gfx]`;
const chars: Record<string, number[][]> = {};

for (let i = 0; i < mapping.length; i++) {
  const c = mapping[i];

  const grid: number[][] = [];
  chars[c] = grid;

  for (let y = 0; y < 4; y++) {
    const row: number[] = [];
    grid.push(row);

    for (let x = 0; x < 4; x++) {
      const px = (i % 16) * 8 + 1 + x;
      const py = (Math.floor(i / 16) * 8) + y;
      const index = 9 + (px + py * 16 * 8);

      row.push(src[index] === '0' ? 0 : 7);
    }
  }
}

export function print(x: number, y: number, text: string) {
  text = text.toLowerCase();

  for (let i = 0; i < text.length; i++) {
    const ch = text[i];
    const map = chars[ch];

    for (let yy = 0; yy < 4; yy++) {
      for (let xx = 0; xx < 4; xx++) {
        const px = x + (i * 4) + xx;
        const py = y + yy;

        const col = map[yy][xx];
        if (col > 0) {
          pset(col, px, py);
        }
      }
    }
  }
}
